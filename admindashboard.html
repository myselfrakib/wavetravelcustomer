<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - WaveTravel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #74EBD5 0%, #ACB6E5 100%);
      margin: 0;
      padding: 0;
    }
    header {
      background: #2C3E50;
      padding: 20px;
      text-align: center;
      color: white;
      font-size: 24px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background: #34495E;
    }
    .tabs button {
      background: none;
      border: none;
      color: white;
      padding: 15px 20px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    .tabs button:hover {
      background: #2C3E50;
    }
    .tab-pane {
      display: none;
      padding: 20px;
    }
    .tab-pane.active {
      display: block;
    }
    .card {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
    }
    .card-header {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .action-buttons {
      margin-top: 10px;
    }
    .action-buttons button {
      margin-right: 8px;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .approve {
      background-color: #2ecc71;
      color: white;
    }
    .reject {
      background-color: #e74c3c;
      color: white;
    }
  </style>
</head>

<body>

<header>WaveTravel Admin Dashboard</header>

<div class="tabs">
  <button onclick="openTab('users')">Users</button>
  <button onclick="openTab('drivers')">Drivers</button>
  <button onclick="openTab('pending-cars')">Pending Cars</button>
  <button onclick="openTab('slots')">Slots</button>
  <button onclick="openTab('bookings')">Bookings</button>
  <button onclick="openTab('profile')">Profile</button>
</div>

<div id="users-tab" class="tab-pane"></div>
<div id="drivers-tab" class="tab-pane"></div>
<div id="pending-cars-tab" class="tab-pane"></div>
<div id="slots-tab" class="tab-pane"></div>
<div id="bookings-tab" class="tab-pane"></div>
<div id="profile-tab" class="tab-pane"></div>

<script type="module">

// ======= Firebase Setup =======
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
import { getDatabase, ref, get, update, remove } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
  authDomain: "wavetravel-3c4c4.firebaseapp.com",
  databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
  projectId: "wavetravel-3c4c4",
  storageBucket: "wavetravel-3c4c4.appspot.com",
  messagingSenderId: "298226098137",
  appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ======= Functions =======
function openTab(tabName) {
  const tabs = document.querySelectorAll('.tab-pane');
  tabs.forEach(tab => tab.classList.remove('active'));

  const activeTab = document.getElementById(tabName + '-tab');
  if (activeTab) {
    activeTab.classList.add('active');
  }

  if (tabName === 'users') {
    fetchData('/users', 'users-tab');
  } else if (tabName === 'drivers') {
    fetchData('/drivers', 'drivers-tab');
  } else if (tabName === 'pending-cars') {
    fetchData('/pendingcars', 'pending-cars-tab', true);
  } else if (tabName === 'slots') {
    fetchData('/availableslots', 'slots-tab');
  } else if (tabName === 'bookings') {
    fetchData('/bookings', 'bookings-tab');
  } else if (tabName === 'profile') {
    fetchProfile();
  }
}
window.openTab = openTab; // Expose globally for button onclicks

async function fetchData(path, elementId, showActions = false) {
  const dbRef = ref(db, path);
  const snapshot = await get(dbRef);
  const container = document.getElementById(elementId);
  container.innerHTML = '';

  if (snapshot.exists()) {
    const data = snapshot.val();
    for (const id in data) {
      const item = data[id];
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-header">${item.name || item.email || item.car || 'Unknown'}</div>
        <div class="card-body">
          <pre>${JSON.stringify(item, null, 2)}</pre>
          ${showActions ? `
            <div class="action-buttons">
              <button class="approve" onclick="approveCar('${id}')">Approve</button>
              <button class="reject" onclick="rejectCar('${id}')">Reject</button>
            </div>
          ` : ''}
        </div>
      `;
      container.appendChild(card);
    }
  } else {
    container.innerHTML = '<p>No data available.</p>';
  }
}

async function fetchProfile() {
  const profileRef = ref(db, '/admins/KAgLbgB2hNbbDrgBebJV1birY463');
  const snapshot = await get(profileRef);
  const container = document.getElementById('profile-tab');
  container.innerHTML = '';

  if (snapshot.exists()) {
    const data = snapshot.val();
    container.innerHTML = `
      <div class="card">
        <div class="card-header">Admin Profile</div>
        <div class="card-body">
          <pre>${JSON.stringify(data, null, 2)}</pre>
        </div>
      </div>
    `;
  } else {
    container.innerHTML = '<p>No profile found.</p>';
  }
}

// Approve or Reject car functions
window.approveCar = async function(id) {
  const carRef = ref(db, `/pendingcars/${id}`);
  await update(carRef, { approved: true });
  alert('Car approved!');
  openTab('pending-cars');
}

window.rejectCar = async function(id) {
  const carRef = ref(db, `/pendingcars/${id}`);
  await remove(carRef);
  alert('Car rejected!');
  openTab('pending-cars');
}

</script>

</body>
</html>

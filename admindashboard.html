<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard - WaveTravel</title>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom right, #0077b6, #00b4d8);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: #fff;
    }
    header {
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      background: rgba(0,0,0,0.2);
    }
    .container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .tab {
      display: none;
    }
    .active-tab {
      display: block;
    }
    .card {
      background: #ffffff22;
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .bottom-nav {
      display: flex;
      justify-content: space-around;
      background: rgba(0,0,0,0.3);
      padding: 10px;
    }
    .bottom-nav button {
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    .bottom-nav button.active {
      font-weight: bold;
      border-bottom: 2px solid #fff;
    }
    .btn {
      background-color: #00b4d8;
      border: none;
      padding: 8px 12px;
      margin: 5px;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn.delete {
      background-color: #ef233c;
    }
    .btn.approve {
      background-color: #06d6a0;
    }
    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
      background: #ffffff22;
      border-radius: 10px;
    }
    table th, table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ffffff44;
    }
    .toast {
      visibility: hidden;
      max-width: 50%;
      min-width: 200px;
      margin-left: -125px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 2px;
      padding: 16px;
      position: fixed;
      z-index: 1;
      left: 50%;
      top: 30px;
      font-size: 17px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      opacity: 0;
      transition: opacity 0.5s, top 0.5s;
    }
    .toast.show {
      visibility: visible;
      opacity: 1;
      top: 50px;
    }
  </style>
</head>
<body>

<header>Admin Dashboard</header>

<div class="container">
  <div id="dashboard" class="tab active-tab">
    <div class="card" id="summaryCards">Loading summary...</div>
  </div>

  <div id="users" class="tab">
    <div class="card">
      <h3>Users</h3>
      <div id="usersList"></div>
    </div>
  </div>

  <div id="drivers" class="tab">
    <div class="card">
      <h3>Drivers</h3>
      <div id="driversList"></div>
    </div>
  </div>

  <div id="pendingcars" class="tab">
    <div class="card">
      <h3>Pending Cars</h3>
      <div id="pendingCarsList"></div>
    </div>
  </div>

  <div id="slots" class="tab">
    <div class="card">
      <h3>Slots</h3>
      <div id="slotsList"></div>
    </div>
  </div>

  <div id="bookings" class="tab">
    <div class="card">
      <h3>Bookings</h3>
      <div id="bookingsList"></div>
    </div>
  </div>

  <div id="profile" class="tab">
    <div class="card">
      <h3>Admin Profile</h3>
      <p>Email: contactwaveride@gmail.com</p>
    </div>
  </div>
</div>

<div class="bottom-nav">
  <button class="nav-btn active" onclick="openTab('dashboard', this)">Dashboard</button>
  <button class="nav-btn" onclick="openTab('users', this)">Users</button>
  <button class="nav-btn" onclick="openTab('drivers', this)">Drivers</button>
  <button class="nav-btn" onclick="openTab('pendingcars', this)">Pending Cars</button>
  <button class="nav-btn" onclick="openTab('slots', this)">Slots</button>
  <button class="nav-btn" onclick="openTab('bookings', this)">Bookings</button>
  <button class="nav-btn" onclick="openTab('profile', this)">Profile</button>
</div>

<!-- Toast Notifications -->
<div id="toast" class="toast">Action completed successfully!</div>

<!-- Firebase Scripts -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getDatabase, ref, onValue, remove, update, set } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
    authDomain: "wavetravel-3c4c4.firebaseapp.com",
    databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
    projectId: "wavetravel-3c4c4",
    storageBucket: "wavetravel-3c4c4.appspot.com",
    messagingSenderId: "298226098137",
    appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Toast display function
  function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = "toast show";
    setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
  }

  // Load summary cards
  function loadSummary() {
    Promise.all([
      getCount('users'),
      getCount('driverdetails'),
      getCount('pendingcars'),
      getCount('bookings')
    ]).then(([userCount, driverCount, pendingCars, bookings]) => {
      document.getElementById('summaryCards').innerHTML = `
        <p>Users: ${userCount}</p>
        <p>Drivers: ${driverCount}</p>
        <p>Pending Cars: ${pendingCars}</p>
        <p>Bookings: ${bookings}</p>
      `;
    });
  }

  function getCount(node) {
    return new Promise((resolve) => {
      const nodeRef = ref(db, node);
      onValue(nodeRef, (snapshot) => {
        resolve(snapshot.exists() ? Object.keys(snapshot.val()).length : 0);
      }, { onlyOnce: true });
    });
  }

  // Load users
  function loadUsers() {
    const usersRef = ref(db, 'users');
    onValue(usersRef, (snapshot) => {
      const users = snapshot.val() || {};
      let html = '<table><tr><th>Name</th><th>Email</th><th>Action</th></tr>';
      Object.keys(users).forEach(key => {
        html += `<tr><td>${users[key].name}</td><td>${users[key].email}</td><td><button class="btn delete" onclick="deleteUser('${key}')">Delete</button></td></tr>`;
      });
      html += '</table>';
      document.getElementById('usersList').innerHTML = html;
    });
  }

  window.deleteUser = function(id) {
    remove(ref(db, 'users/' + id)).then(() => showToast("User deleted successfully"));
  }

  // Load drivers
  function loadDrivers() {
    const driversRef = ref(db, 'driverdetails');
    onValue(driversRef, (snapshot) => {
      const drivers = snapshot.val() || {};
      let html = '<table><tr><th>Name</th><th>Phone</th><th>Action</th></tr>';
      Object.keys(drivers).forEach(key => {
        html += `<tr><td>${drivers[key].name}</td><td>${drivers[key].phone}</td><td><button class="btn delete" onclick="deleteDriver('${key}')">Delete</button></td></tr>`;
      });
      html += '</table>';
      document.getElementById('driversList').innerHTML = html;
    });
  }

  window.deleteDriver = function(id) {
    remove(ref(db, 'driverdetails/' + id)).then(() => showToast("Driver deleted successfully"));
  }

  // Load pending cars
  function loadPendingCars() {
    const carsRef = ref(db, 'pendingcars');
    onValue(carsRef, (snapshot) => {
      const cars = snapshot.val() || {};
      let html = '<table><tr><th>Car</th><th>Action</th></tr>';
      Object.keys(cars).forEach(key => {
        html += `<tr><td>${cars[key].car}</td><td><button class="btn approve" onclick="approveCar('${key}')">Approve</button></td></tr>`;
      });
      html += '</table>';
      document.getElementById('pendingCarsList').innerHTML = html;
    });
  }

  window.approveCar = function(id) {
    update(ref(db, 'pendingcars/' + id), { status: 'approved' }).then(() => showToast("Car approved successfully"));
  }

  // Load slots
  function loadSlots() {
    const slotsRef = ref(db, 'availableslots');
    onValue(slotsRef, (snapshot) => {
      const slots = snapshot.val() || {};
      let html = '<table><tr><th>Slot</th><th>Action</th></tr>';
      Object.keys(slots).forEach(key => {
        html += `<tr><td>${slots[key].slot}</td><td><button class="btn delete" onclick="deleteSlot('${key}')">Delete</button></td></tr>`;
      });
      html += '</table>';
      document.getElementById('slotsList').innerHTML = html;
    });
  }

  window.deleteSlot = function(id) {
    remove(ref(db, 'availableslots/' + id)).then(() => showToast("Slot deleted successfully"));
  }

  // Load bookings
  function loadBookings() {
    const bookingsRef = ref(db, 'bookings');
    onValue(bookingsRef, (snapshot) => {
      const bookings = snapshot.val() || {};
      let html = '<table><tr><th>Customer</th><th>Pickup</th><th>Drop-off</th><th>Action</th></tr>';
      Object.keys(bookings).forEach(key => {
        html += `<tr><td>${bookings[key].customer}</td><td>${bookings[key].pickup}</td><td>${bookings[key].dropoff}</td><td><button class="btn delete" onclick="deleteBooking('${key}')">Cancel</button></td></tr>`;
      });
      html += '</table>';
      document.getElementById('bookingsList').innerHTML = html;
    });
  }

  window.deleteBooking = function(id) {
    remove(ref(db, 'bookings/' + id)).then(() => showToast("Booking cancelled successfully"));
  }

  function openTab(tabName, button) {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => tab.classList.remove('active-tab'));
    document.getElementById(tabName).classList.add('active-tab');

    const navButtons = document.querySelectorAll('.nav-btn');
    navButtons.forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
  }

  // Load all data
  loadSummary();
  loadUsers();
  loadDrivers();
  loadPendingCars();
  loadSlots();
  loadBookings();
</script>

</body>
</html>

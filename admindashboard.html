<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - WaveTravel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Basic Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }
    body {
      background: linear-gradient(to bottom right, #4facfe, #00f2fe);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: #fff;
    }
    header {
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      background: rgba(0, 0, 0, 0.2);
    }
    main {
      flex: 1;
      padding: 20px;
    }
    .tabcontent {
      display: none;
      animation: fadeEffect 0.5s;
    }
    .activeTab {
      display: block;
    }
    @keyframes fadeEffect {
      from {opacity: 0;}
      to {opacity: 1;}
    }
    .navbar {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
    }
    .navbar button {
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    .navbar button.active {
      font-weight: bold;
      text-decoration: underline;
    }
    .card {
      background: rgba(255, 255, 255, 0.2);
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 12px;
    }
  </style>
</head>

<body>

<header>Admin Dashboard</header>

<main>
  <div id="Dashboard" class="tabcontent activeTab">
    <h2>Dashboard Summary</h2>
    <div class="card" id="userCount">Users: Loading...</div>
    <div class="card" id="driverCount">Drivers: Loading...</div>
    <div class="card" id="pendingCarsCount">Pending Cars: Loading...</div>
    <div class="card" id="totalBookingsCount">Total Bookings: Loading...</div>
  </div>

  <div id="Users" class="tabcontent">
    <h2>All Users</h2>
    <div id="usersList"></div>
  </div>

  <div id="Drivers" class="tabcontent">
    <h2>All Drivers</h2>
    <div id="driversList"></div>
  </div>

  <div id="PendingCars" class="tabcontent">
    <h2>Pending Cars</h2>
    <div id="pendingCarsList"></div>
  </div>

  <div id="Slots" class="tabcontent">
    <h2>Available Slots</h2>
    <div id="slotsList"></div>
  </div>

  <div id="Bookings" class="tabcontent">
    <h2>All Bookings</h2>
    <div id="bookingsList"></div>
  </div>

  <div id="Profile" class="tabcontent">
    <h2>Admin Profile</h2>
    <button onclick="logout()">Logout</button>
  </div>
</main>

<div class="navbar">
  <button onclick="openTab('Dashboard')" class="active">Dashboard</button>
  <button onclick="openTab('Users')">Users</button>
  <button onclick="openTab('Drivers')">Drivers</button>
  <button onclick="openTab('PendingCars')">Pending Cars</button>
  <button onclick="openTab('Slots')">Slots</button>
  <button onclick="openTab('Bookings')">Bookings</button>
  <button onclick="openTab('Profile')">Profile</button>
</div>

<!-- Firebase Scripts -->
<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";
  import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
    authDomain: "wavetravel-3c4c4.firebaseapp.com",
    databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
    projectId: "wavetravel-3c4c4",
    storageBucket: "wavetravel-3c4c4.appspot.com",
    messagingSenderId: "298226098137",
    appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // Check Admin Login
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      alert("Unauthorized! Redirecting...");
      window.location.href = "adminlogin.html";
    }
  });

  // Navbar Tab Switch
  function openTab(tabName) {
    document.querySelectorAll(".tabcontent").forEach(tab => tab.classList.remove("activeTab"));
    document.getElementById(tabName).classList.add("activeTab");
    document.querySelectorAll(".navbar button").forEach(btn => btn.classList.remove("active"));
    event.target.classList.add("active");
  }

  // Logout Admin
  function logout() {
    signOut(auth).then(() => {
      window.location.href = "adminlogin.html";
    }).catch((error) => {
      alert("Error logging out!");
    });
  }

  // Load Dashboard Summary
  onValue(ref(db, 'users'), (snapshot) => {
    document.getElementById('userCount').innerText = `Users: ${snapshot.size || Object.keys(snapshot.val() || {}).length}`;
    loadUsers(snapshot.val());
  });

  onValue(ref(db, 'driverdetails'), (snapshot) => {
    document.getElementById('driverCount').innerText = `Drivers: ${snapshot.size || Object.keys(snapshot.val() || {}).length}`;
    loadDrivers(snapshot.val());
  });

  onValue(ref(db, 'pendingcars'), (snapshot) => {
    document.getElementById('pendingCarsCount').innerText = `Pending Cars: ${snapshot.size || Object.keys(snapshot.val() || {}).length}`;
    loadPendingCars(snapshot.val());
  });

  onValue(ref(db, 'bookings'), (snapshot) => {
    document.getElementById('totalBookingsCount').innerText = `Total Bookings: ${snapshot.size || Object.keys(snapshot.val() || {}).length}`;
    loadBookings(snapshot.val());
  });

  onValue(ref(db, 'availableslots'), (snapshot) => {
    loadSlots(snapshot.val());
  });

  // Load Users List
  function loadUsers(users) {
    let html = '';
    if (users) {
      Object.keys(users).forEach(uid => {
        html += `<div class="card">UID: ${uid}<br>Email: ${users[uid].email || 'N/A'}</div>`;
      });
    }
    document.getElementById('usersList').innerHTML = html;
  }

  // Load Drivers List
  function loadDrivers(drivers) {
    let html = '';
    if (drivers) {
      Object.keys(drivers).forEach(uid => {
        html += `<div class="card">Driver: ${drivers[uid].name || 'N/A'}<br>Phone: ${drivers[uid].phone || 'N/A'}</div>`;
      });
    }
    document.getElementById('driversList').innerHTML = html;
  }

  // Load Pending Cars
  function loadPendingCars(cars) {
    let html = '';
    if (cars) {
      Object.keys(cars).forEach(carId => {
        html += `<div class="card">Model: ${cars[carId].model || 'N/A'}<br><button onclick="approveCar('${carId}')">Approve</button></div>`;
      });
    }
    document.getElementById('pendingCarsList').innerHTML = html;
  }

  // Approve Pending Car
  function approveCar(carId) {
    const pendingCarRef = ref(db, `pendingcars/${carId}`);
    onValue(pendingCarRef, (snapshot) => {
      const carData = snapshot.val();
      if (carData) {
        const carsRef = ref(db, `cars/${carId}`);
        update(carsRef, carData).then(() => {
          remove(pendingCarRef);
          alert("Car approved and moved!");
        });
      }
    }, { onlyOnce: true });
  }

  // Load Slots
  function loadSlots(slots) {
    let html = '';
    if (slots) {
      Object.keys(slots).forEach(slotId => {
        html += `<div class="card">Slot: ${JSON.stringify(slots[slotId])}</div>`;
      });
    }
    document.getElementById('slotsList').innerHTML = html;
  }

  // Load Bookings
  function loadBookings(bookings) {
    let html = '';
    if (bookings) {
      Object.keys(bookings).forEach(bookingId => {
        html += `<div class="card">Booking: ${JSON.stringify(bookings[bookingId])}</div>`;
      });
    }
    document.getElementById('bookingsList').innerHTML = html;
  }

</script>

</body>
</html>

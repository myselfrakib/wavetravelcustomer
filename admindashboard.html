<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard – WaveTravel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #2c3e50, #3498db);
      color: white;
      margin: 0; padding: 0;
    }
    .navbar {
      background: #1f2c3f;
      padding: 1rem;
      display: flex; flex-wrap: wrap; gap: .5rem;
    }
    .navbar button {
      background: #3498db; border: none;
      padding: .5rem 1rem; color: white;
      cursor: pointer; border-radius: 4px; flex-grow: 1;
    }
    .tab-pane { display: none; padding: 1rem; }
    .tab-pane.active { display: block; }
    .card {
      background: #ffffff11; padding: 1rem;
      margin: .5rem 0; border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
      position: relative;
    }
    .card button {
      margin-top: .5rem; margin-right: .5rem;
      padding: .3rem .8rem; border: none;
      border-radius: 4px; cursor: pointer;
      background: #e74c3c; color: white;
    }
    .loading { text-align: center; margin-top: 2rem; font-size: 1.2rem; }
  </style>
</head>
<body>
  <div class="navbar">
    <button onclick="openTab('users')">Users</button>
    <button onclick="openTab('drivers')">Drivers</button>
    <button onclick="openTab('pending-cars')">Pending Cars</button>
    <button onclick="openTab('approved-cars')">Approved Cars</button>
    <button onclick="openTab('slots')">Slots</button>
    <button onclick="openTab('bookings')">Bookings</button>
    <button onclick="openTab('profile')">Profile</button>
  </div>

  <div id="users-tab" class="tab-pane"><h2>Users</h2><div id="users-list"></div></div>
  <div id="drivers-tab" class="tab-pane"><h2>Drivers</h2><div id="drivers-list"></div></div>
  <div id="pending-cars-tab" class="tab-pane"><h2>Pending Cars</h2><div id="pending-cars-list"></div></div>
  <div id="approved-cars-tab" class="tab-pane"><h2>Approved Cars</h2><div id="approved-cars-list"></div></div>
  <div id="slots-tab" class="tab-pane"><h2>Slots</h2><div id="slots-list"></div></div>
  <div id="bookings-tab" class="tab-pane"><h2>Bookings</h2><div id="bookings-list"></div></div>
  <div id="profile-tab" class="tab-pane"><h2>Admin Profile</h2><div id="profile-details"></div></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, get, remove, set } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
      authDomain: "wavetravel-3c4c4.firebaseapp.com",
      databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
      projectId: "wavetravel-3c4c4",
      storageBucket: "wavetravel-3c4c4.appspot.com",
      messagingSenderId: "298226098137",
      appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    let currentTab = '';

    window.openTab = function(tabName) {
      currentTab = tabName;
      document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
      document.getElementById(`${tabName}-tab`).classList.add('active');

      if (tabName === 'users')          fetchList('users','users-list');
      if (tabName === 'drivers')        fetchList('driverdetails','drivers-list');
      if (tabName === 'pending-cars')   fetchList('pendingcars','pending-cars-list');
      if (tabName === 'approved-cars')  fetchList('approvedcars','approved-cars-list');
      if (tabName === 'slots')          fetchNested('availableslots','slots-list');
      if (tabName === 'bookings')       fetchNested('bookings','bookings-list');
      if (tabName === 'profile')        fetchProfile();
    };

    // flat list at root: users, driverdetails, pendingcars, approvedcars
    async function fetchList(path, containerId) {
      const c = document.getElementById(containerId);
      c.innerHTML = '<div class="loading">Loading…</div>';
      try {
        const snap = await get(ref(db, path));
        if (!snap.exists()) {
          c.innerHTML = 'No records';
          return;
        }
        let html = '';
        for (const [key, val] of Object.entries(snap.val())) {
          html += `<div class="card">
                     <strong>${path.slice(0,-1).toUpperCase()} ID:</strong> ${key}<br/>` +
                     Object.entries(val)
                           .map(([k,v])=>`<strong>${k}:</strong> ${v}`)
                           .join('<br/>') +
                     `<br/><button onclick="deleteItem('${path}','${key}')">Delete</button>
                   </div>`;
        }
        c.innerHTML = html;
      } catch(err) {
        c.innerHTML = 'Error loading';
        console.error(err);
      }
    }

    // nested lists: e.g. availableslots/{driverId}/{slotKey}, bookings similar
    async function fetchNested(path, containerId) {
      const c = document.getElementById(containerId);
      c.innerHTML = '<div class="loading">Loading…</div>';
      try {
        const snap = await get(ref(db, path));
        if (!snap.exists()) {
          c.innerHTML = 'No records';
          return;
        }
        let html = '';
        for (const [driverId, slots] of Object.entries(snap.val())) {
          for (const [key, val] of Object.entries(slots)) {
            html += `<div class="card">
                       <strong>${path.slice(0,-1).toUpperCase()} ID:</strong> ${key}<br/>` +
                       Object.entries(val)
                             .map(([k,v])=>`<strong>${k}:</strong> ${v}`)
                             .join('<br/>') +
                       `<br/><button onclick="deleteItem('${path}/${driverId}','${key}')">Delete</button>
                     </div>`;
          }
        }
        c.innerHTML = html;
      } catch(err) {
        c.innerHTML = 'Error loading';
        console.error(err);
      }
    }

    // special for admin profile (single node under /admins)
    async function fetchProfile() {
      const c = document.getElementById('profile-details');
      c.innerHTML = '<div class="loading">Loading…</div>';
      try {
        const snap = await get(ref(db, 'admins/hd07y5jW91M6QJFi9ykZ55jLwx12'));
        if (!snap.exists()) {
          c.innerHTML = 'No profile';
          return;
        }
        const data = snap.val();
        let html = '<div class="card">';
        html += Object.entries(data)
                      .map(([k,v])=>`<strong>${k}:</strong> ${v}`)
                      .join('<br/>');
        html += '</div>';
        c.innerHTML = html;
      } catch(err) {
        c.innerHTML = 'Error loading';
        console.error(err);
      }
    }

    // delete any node
    window.deleteItem = async function(path, key) {
      if (!confirm('Delete this entry?')) return;
      try {
        await remove(ref(db, `${path}/${key}`));
        openTab(currentTab);
      } catch(err) {
        alert('Delete failed');
        console.error(err);
      }
    };

    // kick things off
    openTab('users');
  </script>
</body>
</html>

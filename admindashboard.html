<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #2c3e50, #3498db);
      color: white;
      margin: 0;
      padding: 0;
    }
    .navbar {
      background: #1f2c3f;
      padding: 1rem;
      display: flex;
      gap: 1rem;
    }
    .navbar button {
      background: #3498db;
      border: none;
      padding: 0.5rem 1rem;
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }
    .tab-pane {
      display: none;
      padding: 1rem;
    }
    .tab-pane.active {
      display: block;
    }
    .card {
      background: #ffffff11;
      padding: 1rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
      position: relative;
    }
    .card button {
      margin-top: 0.5rem;
      margin-right: 0.5rem;
      padding: 0.3rem 0.8rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .edit-btn { background: #f39c12; color: white; }
    .delete-btn { background: #e74c3c; color: white; }
    .approve-btn { background: #2ecc71; color: white; }
  </style>
</head>
<body>
  <div class="navbar">
    <button onclick="openTab('users')">Users</button>
    <button onclick="openTab('drivers')">Drivers</button>
    <button onclick="openTab('pending-cars')">Pending Cars</button>
    <button onclick="openTab('slots')">Slots</button>
    <button onclick="openTab('bookings')">Bookings</button>
    <button onclick="openTab('profile')">Profile</button>
  </div>

  <div id="users-tab" class="tab-pane"><h2>Users</h2><div id="users-list"></div></div>
  <div id="drivers-tab" class="tab-pane"><h2>Drivers</h2><div id="drivers-list"></div></div>
  <div id="pending-cars-tab" class="tab-pane"><h2>Pending Cars</h2><div id="pending-cars-list"></div></div>
  <div id="slots-tab" class="tab-pane"><h2>Slots</h2><div id="slots-list"></div></div>
  <div id="bookings-tab" class="tab-pane"><h2>Bookings</h2><div id="bookings-list"></div></div>
  <div id="profile-tab" class="tab-pane"><h2>Admin Profile</h2><div id="profile-details"></div></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, get, remove, update, set } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
      authDomain: "wavetravel-3c4c4.firebaseapp.com",
      databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
      projectId: "wavetravel-3c4c4",
      storageBucket: "wavetravel-3c4c4.appspot.com",
      messagingSenderId: "298226098137",
      appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function openTab(tabName) {
      document.querySelectorAll('.tab-pane').forEach(tab => tab.classList.remove('active'));
      document.getElementById(`${tabName}-tab`).classList.add('active');

      if (tabName === 'users') fetchData('/users', 'users-list');
      if (tabName === 'drivers') fetchData('/drivers', 'drivers-list');
      if (tabName === 'pending-cars') fetchData('/pendingcars', 'pending-cars-list', false, true);
      if (tabName === 'slots') fetchData('/availableslots', 'slots-list');
      if (tabName === 'bookings') fetchData('/bookings', 'bookings-list');
      if (tabName === 'profile') fetchData('/admins/KAgLbgB2hNbbDrgBebJV1birY463', 'profile-details', true);
    }
    window.openTab = openTab;

    function fetchData(path, containerId, singleItem = false, isPendingCars = false) {
      const dataRef = ref(db, path);
      get(dataRef).then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          let html = '';
          if (singleItem) {
            html = `<div class='card'>${Object.entries(data).map(([k,v]) => `<strong>${k}:</strong> ${v}`).join('<br/>')}</div>`;
          } else {
            for (const key in data) {
              const item = data[key];
              html += `<div class='card'><strong>ID:</strong> ${key}<br/>${Object.entries(item).map(([k,v]) => `<strong>${k}:</strong> ${v}`).join('<br/>')}<br/><br/>
              <button class='edit-btn' onclick="editItem('${path}','${key}')">Edit</button>
              <button class='delete-btn' onclick="deleteItem('${path}','${key}')">Delete</button>
              ${isPendingCars ? `<button class='approve-btn' onclick="approveCar('${key}')">Approve</button>` : ''}
              </div>`;
            }
          }
          document.getElementById(containerId).innerHTML = html;
        } else {
          document.getElementById(containerId).innerHTML = 'No data found.';
        }
      }).catch(err => {
        console.error('Error fetching:', err);
        document.getElementById(containerId).innerText = 'Error loading data.';
      });
    }

    window.deleteItem = function(path, key) {
      if (confirm('Are you sure you want to delete this item?')) {
        remove(ref(db, `${path}/${key}`)).then(() => {
          alert('Deleted successfully.');
          openTab(document.querySelector('.tab-pane.active').id.replace('-tab',''));
        }).catch(err => console.error('Delete error:', err));
      }
    }

    window.editItem = function(path, key) {
      const itemRef = ref(db, `${path}/${key}`);
      get(itemRef).then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          const updatedData = {};
          for (const field in data) {
            const newValue = prompt(`Edit ${field}:`, data[field]);
            if (newValue !== null) updatedData[field] = newValue;
          }
          update(itemRef, updatedData).then(() => {
            alert('Updated successfully.');
            openTab(document.querySelector('.tab-pane.active').id.replace('-tab',''));
          });
        }
      });
    }

    window.approveCar = function(key) {
      const pendingCarRef = ref(db, `/pendingcars/${key}`);
      get(pendingCarRef).then(snapshot => {
        if (snapshot.exists()) {
          const carData = snapshot.val();
          if (!carData.driverId) {
            alert('driverId missing. Cannot approve.');
            return;
          }
          const approvedCarRef = ref(db, `/cars/${carData.driverId}/${key}`);
          set(approvedCarRef, carData).then(() => {
            remove(pendingCarRef).then(() => {
              alert('Car approved and moved to /cars.');
              openTab('pending-cars');
            });
          });
        } else {
          alert('Car not found.');
        }
      }).catch(err => console.error('Approve error:', err));
    }

  </script>
</body>
</html>

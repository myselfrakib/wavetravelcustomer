<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WaveTravel QR System</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background-color: #f9f9f9;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background-color: #2196f3;
    }
    .tab {
      padding: 1rem;
      cursor: pointer;
      color: white;
      font-weight: bold;
    }
    .tab.active {
      background-color: #0d8bf2;
    }
    .container {
      max-width: 600px;
      margin: 2rem auto;
      background: white;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      margin-top: 1rem;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: center;
    }
    .qr-output {
      text-align: center;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" id="generate-tab">Generate QR</div>
    <div class="tab" id="scan-tab">Scan QR</div>
  </div>  <div class="container" id="generate-container">
    <h2>Generate QR</h2>
    <input id="name" placeholder="Name" />
    <select id="pickup"></select>
    <select id="dropoff"></select>
    <input type="time" id="time" />
    <button onclick="generateBooking()">Generate QR</button>
    <div class="qr-output" id="generated-qr"></div>
    <h3>My Bookings</h3>
    <table id="booking-table">
      <thead>
        <tr><th>#</th><th>Date</th><th>Name</th><th>Pickup</th><th>Dropoff</th><th>Fare</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <div class="container" id="scan-container" style="display: none;">
    <h2>Scan QR</h2>
    <div id="reader" style="width: 100%;"></div>
    <table id="scanned-table" style="margin-top: 1rem;">
      <thead>
        <tr><th>#</th><th>Date</th><th>Name</th><th>Pickup</th><th>Dropoff</th><th>Fare</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
      authDomain: "wavetravel-3c4c4.firebaseapp.com",
      databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
      projectId: "wavetravel-3c4c4",
      storageBucket: "wavetravel-3c4c4.appspot.com",
      messagingSenderId: "298226098137",
      appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let locations = {};
    const pickupSelect = document.getElementById("pickup");
    const dropoffSelect = document.getElementById("dropoff");
    const qrDiv = document.getElementById("generated-qr");
    const bookingsTbody = document.querySelector("#booking-table tbody");
    const scannedTbody = document.querySelector("#scanned-table tbody");

    db.ref("locations").once("value", (snap) => {
      snap.forEach(loc => {
        const { name, index } = loc.val();
        locations[name] = index;
        const option = `<option value="${name}">${name}</option>`;
        pickupSelect.innerHTML += option;
        dropoffSelect.innerHTML += option;
      });
    });

    function generateBooking() {
      const name = document.getElementById("name").value;
      const pickup = pickupSelect.value;
      const dropoff = dropoffSelect.value;
      const time = document.getElementById("time").value;
      if (!name || !pickup || !dropoff || !time) return alert("Fill all fields");
      const fare = Math.abs(locations[pickup] - locations[dropoff]) * 120;
      const bookingId = db.ref().child("qrbooking").push().key;
      const date = new Date().toLocaleString();
      const data = { name, pickup, dropoff, time, fare, date };
      db.ref("qrbooking/" + bookingId).set(data).then(() => {
        addBookingRow(bookingId, data);
        qrDiv.innerHTML = "";
      });
    }

    function addBookingRow(bookingId, data) {
      const row = bookingsTbody.insertRow();
      row.innerHTML = `
        <td>${bookingsTbody.rows.length}</td>
        <td>${data.date}</td>
        <td>${data.name}</td>
        <td>${data.pickup}</td>
        <td>${data.dropoff}</td>
        <td>${data.fare}</td>
        <td><button onclick="showQR('${bookingId}')">Show QR</button></td>
      `;
    }

    function showQR(bookingId) {
      qrDiv.innerHTML = "";
      new Html5QrcodeScanner("generated-qr", { fps: 10, qrbox: 200 }).clear();
      const qr = new QRCode(qrDiv, { text: bookingId, width: 200, height: 200 });
    }

    let html5Qr;
    function onScanSuccess(decodedText) {
      db.ref("qrbooking/" + decodedText).once("value", (snap) => {
        if (!snap.exists()) return;
        const data = snap.val();
        const row = scannedTbody.insertRow();
        row.innerHTML = `
          <td>${scannedTbody.rows.length + 1}</td>
          <td>${data.date}</td>
          <td>${data.name}</td>
          <td>${data.pickup}</td>
          <td>${data.dropoff}</td>
          <td>${data.fare}</td>
        `;
      });
    }

    document.getElementById("scan-tab").addEventListener("click", () => {
      document.getElementById("generate-container").style.display = "none";
      document.getElementById("scan-container").style.display = "block";
      document.getElementById("scan-tab").classList.add("active");
      document.getElementById("generate-tab").classList.remove("active");
      if (!html5Qr) {
        html5Qr = new Html5Qrcode("reader");
        html5Qr.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: 250 },
          onScanSuccess
        );
      }
    });

    document.getElementById("generate-tab").addEventListener("click", () => {
      document.getElementById("scan-container").style.display = "none";
      document.getElementById("generate-container").style.display = "block";
      document.getElementById("scan-tab").classList.remove("active");
      document.getElementById("generate-tab").classList.add("active");
      if (html5Qr) {
        html5Qr.stop().then(() => html5Qr.clear());
      }
    });
  </script>  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script></body>
</html>
<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WaveTravel QR Booking</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f2f5;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background-color: #333;
    }
    .tab {
      padding: 15px 25px;
      color: white;
      cursor: pointer;
    }
    .tab.active {
      background-color: #555;
    }
    .container {
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    .qr-box {
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" id="generate-tab">Generate QR</div>
    <div class="tab" id="scan-tab">Scan QR</div>
  </div>  <div class="container" id="generate-container">
    <h2>Generate QR Booking</h2>
    <input type="text" id="name" placeholder="Customer Name" />
    <select id="pickup"></select>
    <select id="dropoff"></select>
    <input type="time" id="time" />
    <input type="text" id="fare" readonly placeholder="Fare" />
    <button id="generateBtn">Generate QR</button>
    <div class="qr-box" id="qrResult"></div>
    <table id="bookingTable">
      <thead>
        <tr><th>#</th><th>Name</th><th>Pickup</th><th>Dropoff</th><th>Time</th><th>Fare</th><th>QR</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <div class="container" id="scan-container" style="display:none;">
    <h2>Scan QR</h2>
    <div id="reader" style="width:100%;"></div>
    <table id="scanResultTable">
      <thead>
        <tr><th>#</th><th>Name</th><th>Pickup</th><th>Dropoff</th><th>Time</th><th>Fare</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
      authDomain: "wavetravel-3c4c4.firebaseapp.com",
      databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
      projectId: "wavetravel-3c4c4",
      storageBucket: "wavetravel-3c4c4.appspot.com",
      messagingSenderId: "298226098137",
      appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const pickup = document.getElementById("pickup");
    const dropoff = document.getElementById("dropoff");
    const fareInput = document.getElementById("fare");

    let locationMap = {};

    // Load locations
    firebase.database().ref("locations").once("value").then(snapshot => {
      snapshot.forEach(child => {
        const val = child.val();
        const option = new Option(val.name, child.key);
        pickup.append(option.cloneNode(true));
        dropoff.append(option);
        locationMap[child.key] = val.index;
      });
    });

    pickup.addEventListener("change", calculateFare);
    dropoff.addEventListener("change", calculateFare);

    function calculateFare() {
      const from = pickup.value;
      const to = dropoff.value;
      if (from && to && locationMap[from] != null && locationMap[to] != null) {
        const fare = Math.abs(locationMap[from] - locationMap[to]) * 120;
        fareInput.value = fare;
      }
    }

    function generateBookingId() {
      return firebase.database().ref().child("qrbooking").push().key;
    }

    document.getElementById("generateBtn").addEventListener("click", () => {
      const name = document.getElementById("name").value;
      const pickupText = pickup.options[pickup.selectedIndex].text;
      const dropoffText = dropoff.options[dropoff.selectedIndex].text;
      const time = document.getElementById("time").value;
      const fare = fareInput.value;

      if (!name || !pickup.value || !dropoff.value || !time || !fare) return alert("Fill all fields");

      const bookingId = generateBookingId();
      const bookingData = { name, pickup: pickupText, dropoff: dropoffText, time, fare };

      firebase.database().ref("qrbooking/" + bookingId).set(bookingData).then(() => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>#</td><td>${name}</td><td>${pickupText}</td><td>${dropoffText}</td><td>${time}</td><td>${fare}</td><td><button onclick="showQR('${bookingId}')">Show QR</button></td>`;
        document.querySelector("#bookingTable tbody").appendChild(row);
      });
    });

    function showQR(id) {
      const resultDiv = document.getElementById("qrResult");
      resultDiv.innerHTML = "";
      new Html5Qrcode("qrResult").clear(); // Clear previous QR
      const qr = document.createElement("div");
      new Html5Qrcode("qrResult").stop();
      new QRCode(resultDiv, {
        text: id,
        width: 200,
        height: 200,
      });
    }

    // QR Scanner
    let html5Qr;
    const scanResultTable = document.querySelector("#scanResultTable tbody");
    document.getElementById("scan-tab").addEventListener("click", () => {
      document.getElementById("generate-container").style.display = "none";
      document.getElementById("scan-container").style.display = "block";
      html5Qr = new Html5Qrcode("reader");
      html5Qr.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          html5Qr.stop();
          db.ref("qrbooking/" + decodedText).once("value").then(snap => {
            const b = snap.val();
            const row = document.createElement("tr");
            row.innerHTML = `<td>#</td><td>${b.name}</td><td>${b.pickup}</td><td>${b.dropoff}</td><td>${b.time}</td><td>${b.fare}</td>`;
            scanResultTable.appendChild(row);
          });
        }
      );
    });

    document.getElementById("generate-tab").addEventListener("click", () => {
      document.getElementById("generate-container").style.display = "block";
      document.getElementById("scan-container").style.display = "none";
    });
  </script></body>
</html>
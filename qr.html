<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WaveTravel QR Booking</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tabs button {
      padding: 10px 20px;
      margin: 0 10px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    .tabs button.active {
      background: #0056b3;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .form-group {
      margin: 10px 0;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
    }
    .form-group input,
    .form-group select {
      padding: 8px;
      width: 100%;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    #qrCodeDisplay {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
<h2>WaveTravel QR Booking</h2>
<div class="tabs">
  <button id="generate-tab" class="active">Generate QR</button>
  <button id="scan-tab">Scan QR</button>
</div>
<div id="generate" class="tab-content active">
  <div class="form-group">
    <label>Name</label>
    <input type="text" id="nameInput" />
  </div>
  <div class="form-group">
    <label>Pickup Location</label>
    <select id="pickupSelect"></select>
  </div>
  <div class="form-group">
    <label>Dropoff Location</label>
    <select id="dropoffSelect"></select>
  </div>
  <div class="form-group">
    <label>Time</label>
    <input type="time" id="timeInput" />
  </div>
  <div class="form-group">
    <label>Fare (auto-calculated)</label>
    <input type="text" id="fareDisplay" disabled />
  </div>
  <button onclick="generateBooking()">Generate QR</button>
  <table id="bookingTable">
    <thead>
      <tr><th>#</th><th>Name</th><th>Pickup</th><th>Dropoff</th><th>Time</th><th>Fare</th><th>QR</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="qrCodeDisplay"></div>
</div>
<div id="scan" class="tab-content">
  <div id="reader" style="width: 300px; margin:auto;"></div>
  <table id="scanTable">
    <thead>
      <tr><th>#</th><th>Date</th><th>Time</th><th>Name</th><th>Pickup</th><th>Dropoff</th><th>Fare</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
    authDomain: "wavetravel-3c4c4.firebaseapp.com",
    databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
    projectId: "wavetravel-3c4c4",
    storageBucket: "wavetravel-3c4c4.appspot.com",
    messagingSenderId: "298226098137",
    appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();const pickupSelect = document.getElementById("pickupSelect"); const dropoffSelect = document.getElementById("dropoffSelect"); const fareDisplay = document.getElementById("fareDisplay"); let locationMap = {};

db.ref("/locations").once("value", snap => { snap.forEach(loc => { const opt = document.createElement("option"); opt.value = loc.key; opt.textContent = loc.val().name; pickupSelect.appendChild(opt.cloneNode(true)); dropoffSelect.appendChild(opt); locationMap[loc.key] = loc.val(); }); });

pickupSelect.addEventListener("change", updateFare); dropoffSelect.addEventListener("change", updateFare); function updateFare() { const a = locationMap[pickupSelect.value]?.index; const b = locationMap[dropoffSelect.value]?.index; if (a !== undefined && b !== undefined) { const fare = Math.abs(a - b) * 120; fareDisplay.value = fare; } }

function generateBooking() { const name = document.getElementById("nameInput").value; const pickup = pickupSelect.value; const dropoff = dropoffSelect.value; const time = document.getElementById("timeInput").value; const fare = fareDisplay.value; const bookingId = Date.now().toString();

const booking = {
  name,
  pickup: locationMap[pickup].name,
  dropoff: locationMap[dropoff].name,
  time,
  fare: parseInt(fare),
  bookedAt: new Date().toISOString()
};
db.ref("/qrbooking/" + bookingId).set(booking);

const table = document.querySelector("#bookingTable tbody");
const row = table.insertRow();
row.innerHTML = `
  <td>${table.rows.length}</td>
  <td>${booking.name}</td>
  <td>${booking.pickup}</td>
  <td>${booking.dropoff}</td>
  <td>${booking.time}</td>
  <td>${booking.fare}</td>
  <td><button onclick="showQRCode('${bookingId}')">Show QR</button></td>
`;

}

function showQRCode(bookingId) { const qrDisplay = document.getElementById("qrCodeDisplay"); qrDisplay.innerHTML = ""; new Html5QrcodeQRCodeGenerator(qrDisplay).generate(bookingId); }

let scanner; document.getElementById("scan-tab").addEventListener("click", () => { switchTab("scan"); if (!scanner) { scanner = new Html5Qrcode("reader"); scanner.start( { facingMode: "environment" }, { fps: 10, qrbox: 250 }, qrCodeMessage => { db.ref("/qrbooking/" + qrCodeMessage).once("value", snap => { const booking = snap.val(); if (booking) { const t = document.querySelector("#scanTable tbody"); const r = t.insertRow(); const now = new Date(); r.innerHTML = <td>${t.rows.length}</td> <td>${now.toLocaleDateString()}</td> <td>${now.toLocaleTimeString()}</td> <td>${booking.name}</td> <td>${booking.pickup}</td> <td>${booking.dropoff}</td> <td>${booking.fare}</td>; } }); scanner.stop().then(() => { scanner.start( { facingMode: "environment" }, { fps: 10, qrbox: 250 }, qrCodeMessage => console.log("Rescanned", qrCodeMessage) ); }); } ); } });

document.getElementById("generate-tab").addEventListener("click", () => switchTab("generate"));

function switchTab(tabId) { document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active")); document.querySelectorAll(".tabs button").forEach(t => t.classList.remove("active")); document.getElementById(tabId).classList.add("active"); document.getElementById(tabId + "-tab").classList.add("active"); } </script>

</body>
</html>
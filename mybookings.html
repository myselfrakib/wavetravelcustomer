<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Bookings - WaveTravel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body { background:linear-gradient(to right,#74ebd5,#ACB6E5); min-height:100vh; display:flex; flex-direction:column; }
    .container { flex:1; padding:20px; }
    h1 { text-align:center; color:#fff; margin-bottom:20px; }
    .booking-list { margin-top:20px; display:grid; gap:15px; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); }
    .booking-card {
      background:#fff; padding:15px; border-radius:15px;
      box-shadow:0 5px 15px rgba(0,0,0,0.2); transition:transform 0.3s;
    }
    .booking-card:hover { transform:scale(1.03); }
    .navbar {
      background:#fff; padding:10px; display:flex; justify-content:space-around;
      border-top-left-radius:20px; border-top-right-radius:20px;
      box-shadow:0 -3px 10px rgba(0,0,0,0.1);
    }
    .navbar a { color:#0077ff; text-decoration:none; font-size:14px; display:flex; flex-direction:column; align-items:center; }
    .navbar a i { font-size:20px; }
  </style>
</head>
<body>

<div class="container">
  <h1>My Bookings</h1>

  <div id="bookings" class="booking-list">
    <!-- Bookings will be listed here dynamically -->
  </div>
</div>

<div class="navbar">
  <a href="customerdashboard.html"><i class="fas fa-home"></i><span>Home</span></a>
  <a href="booking.html"><i class="fas fa-car"></i><span>Book</span></a>
  <a href="mybookings.html"><i class="fas fa-calendar-check"></i><span>Bookings</span></a>
  <a href="profile.html"><i class="fas fa-user"></i><span>Profile</span></a>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
  // --- INIT FIREBASE ---
  const firebaseConfig = {
    apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
    authDomain: "wavetravel-3c4c4.firebaseapp.com",
    databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
    projectId: "wavetravel-3c4c4",
    storageBucket: "wavetravel-3c4c4.appspot.com",
    messagingSenderId: "298226098137",
    appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
  };
  firebase.initializeApp(firebaseConfig);

  // Get the current user
  const user = firebase.auth().currentUser;
  if (!user) {
    alert('Please login first');
    window.location.href = 'login.html';
  }

  // Fetch and display bookings
  function loadBookings() {
    const bookingsRef = firebase.database().ref('bookings/' + user.uid);
    bookingsRef.once('value').then(snapshot => {
      const bookings = snapshot.val();
      if (!bookings) {
        document.getElementById('bookings').innerHTML = '<p>No bookings found.</p>';
        return;
      }

      let bookingHTML = '';
      Object.keys(bookings).forEach(key => {
        const booking = bookings[key];
        const fare = booking.fare;
        const status = booking.status;

        bookingHTML += `
          <div class="booking-card">
            <h3>Booking ID: ${key}</h3>
            <p><strong>Pickup:</strong> ${booking.pickup}</p>
            <p><strong>Dropoff:</strong> ${booking.dropoff}</p>
            <p><strong>Date:</strong> ${booking.date}</p>
            <p><strong>Time:</strong> ${booking.time}</p>
            <p><strong>Seats:</strong> ${booking.seatsBooked}</p>
            <p><strong>Fare:</strong> â‚¹${fare}</p>
            <p><strong>Status:</strong> ${status}</p>
            <button onclick="cancelBooking('${key}')">Cancel Booking</button>
          </div>
        `;
      });

      document.getElementById('bookings').innerHTML = bookingHTML;
    });
  }

  // Cancel booking
  function cancelBooking(bookingId) {
    const confirmCancel = confirm('Are you sure you want to cancel this booking?');
    if (confirmCancel) {
      firebase.database().ref('bookings/' + user.uid + '/' + bookingId).remove()
        .then(() => {
          alert('Booking cancelled successfully');
          loadBookings();  // Reload bookings after cancellation
        })
        .catch(err => {
          alert('Error cancelling booking: ' + err.message);
        });
    }
  }

  // Load bookings when the page loads
  loadBookings();
</script>

</body>
</html>

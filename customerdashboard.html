<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard - WaveTravel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    /* Mobile-first base */
    html { font-size: 16px; }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body {
      background: linear-gradient(to right, #74ebd5, #ACB6E5);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    .container {
      width:100%;
      max-width:600px;
      margin:0 auto;
      padding:1rem;
    }
    h1 {
      text-align:center;
      color:#fff;
      margin-bottom:1rem;
      font-size:1.75rem;
    }
    .greeting {
      text-align:center;
      color:#fff;
      font-size:1.25rem;
      margin-bottom:1rem;
    }
    .cards {
      display:grid;
      gap:1rem;
      grid-template-columns:1fr;
    }
    .card {
      background:#fff;
      padding:1rem;
      border-radius:1rem;
      box-shadow:0 0.25rem 0.75rem rgba(0,0,0,0.15);
      transition:all 0.3s ease;
      animation:fadeIn 0.6s ease both;
    }
    .card:hover {
      transform:scale(1.02);
    }
    .no-bookings {
      text-align:center;
      background:#fff;
      padding:2rem 1rem;
      border-radius:1rem;
      box-shadow:0 0.25rem 0.75rem rgba(0,0,0,0.2);
      margin-top:2rem;
    }
    .no-bookings img {
      width:80%;
      max-width:300px;
      margin:0 auto 1rem;
      display:block;
    }
    .no-bookings p {
      font-size:1.1rem;
      margin-bottom:1rem;
      color:#333;
    }
    .no-bookings a {
      display:inline-block;
      background:#0077ff;
      color:#fff;
      padding:0.75rem 1.5rem;
      border-radius:2rem;
      font-weight:bold;
      text-decoration:none;
      margin-top:0.5rem;
      transition:background 0.3s;
    }
    .no-bookings a:hover {
      background:#005dc1;
    }
    .navbar {
      background:#fff;
      padding:0.75rem 0;
      display:flex;
      justify-content:space-around;
      border-top-left-radius:1.25rem;
      border-top-right-radius:1.25rem;
      box-shadow:0 -0.1875rem 0.625rem rgba(0,0,0,0.1);
      position:fixed;
      bottom:0;
      width:100%;
      max-width:600px;
      left:50%;
      transform:translateX(-50%);
    }
    .navbar a {
      color:#0077ff;
      text-decoration:none;
      font-size:0.875rem;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    .navbar a i {
      font-size:1.25rem;
      margin-bottom:0.25rem;
    }
    @keyframes fadeIn {
      0% { opacity:0; transform:translateY(10px); }
      100% { opacity:1; transform:translateY(0); }
    }
    .loader {
      border:5px solid #f3f3f3;
      border-top:5px solid #0077ff;
      border-radius:50%;
      width:40px;
      height:40px;
      animation:spin 1s linear infinite;
      margin:2rem auto;
    }
    @keyframes spin {
      0% { transform:rotate(0deg); }
      100% { transform:rotate(360deg); }
    }
  </style>
</head>

<body>

<div class="container">
  <h1>Welcome</h1>
  <div class="greeting" id="greeting">Loading...</div>

  <div id="loader" class="loader"></div>

  <div class="cards" id="cards" style="display:none;"></div>

  <div class="no-bookings" id="nobooking" style="display:none;">
    <img src="https://assets10.lottiefiles.com/packages/lf20_jy4s0b.json" alt="No Bookings">
    <p>No upcoming rides! Plan your journey today.</p>
    <a href="book.html">Book a Ride</a>
  </div>
</div>

<div class="navbar">
  <a href="home.html"><i class="fas fa-home"></i><span>Home</span></a>
  <a href="book.html"><i class="fas fa-car"></i><span>Book</span></a>
  <a href="mybookings.html"><i class="fas fa-calendar-check"></i><span>Bookings</span></a>
  <a href="profile.html"><i class="fas fa-user"></i><span>Profile</span></a>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDsn16p7w8b-x8pEA_WTO5F2oUk4MHwcUc",
    authDomain: "wavetravel-3c4c4.firebaseapp.com",
    databaseURL: "https://wavetravel-3c4c4-default-rtdb.firebaseio.com",
    projectId: "wavetravel-3c4c4",
    storageBucket: "wavetravel-3c4c4.appspot.com",
    messagingSenderId: "298226098137",
    appId: "1:298226098137:web:720953b80e3e61c8bc43c8"
  };
  firebase.initializeApp(firebaseConfig);

  const greetingEl = document.getElementById('greeting');
  const cardsEl = document.getElementById('cards');
  const noBookingEl = document.getElementById('nobooking');
  const loader = document.getElementById('loader');

  firebase.auth().onAuthStateChanged(user=>{
    if(user){
      firebase.database().ref('users/'+user.uid).once('value').then(snapshot=>{
        const userData = snapshot.val();
        greetingEl.innerText = Hi ${userData.name || 'Traveler'}, Welcome back!;
      });

      firebase.database().ref('bookings').orderByChild('userid').equalTo(user.uid).once('value').then(snapshot=>{
        loader.style.display = 'none';
        if(snapshot.exists()){
          cardsEl.style.display = 'grid';
          snapshot.forEach(bookingSnap=>{
            const booking = bookingSnap.val();
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
              <h3>${booking.pickup} âž” ${booking.dropoff}</h3>
              <p><strong>Date:</strong> ${booking.date}</p>
              <p><strong>Time:</strong> ${booking.time}</p>
              <p><strong>Seats:</strong> ${booking.seats}</p>
              <p><strong>Status:</strong> ${booking.status || 'Upcoming'}</p>
            `;
            cardsEl.appendChild(card);
          });
        } else {
          noBookingEl.style.display = 'block';
        }
      });

    } else {
      window.location.href = "login.html";
    }
  });
</script>

</body>
</html>
